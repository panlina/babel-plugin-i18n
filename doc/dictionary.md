# 字典

`@jacklu/babel-plugin-i18n`使用字典里的词条来翻译程序。

字典是`json`对象，它的每个属性都是一个词条，属性名称是源文本，值是目标文本。

## 示例：

```json
{
	"你好，{}": "Hello, {}",
	..: ..
}
```

源文本和目标文本中都带有特定标记来表达匹配和翻译规则。

## 字面文本

非特殊标记的文本都是字面文本，直接匹配程序中完全一致的文本。

比如`确定`直接匹配`"确定"`。

## 占位符`{}`

在源文本里`{}`匹配做任意表达式。主要用于匹配模板字符串和jsx元素。

比如`你好，{}`匹配`` `你好，${name}` ``，也匹配`<div>你好，{name}</div>`。

在目标文本里`{}`引用被匹配的表达式。当有多个占位符时，用序号区分。

比如`{ "第{}-{}条记录，共{}条": "Record {0}-{1} of all {2} record(s)" }`。

## 复数`(s)`

`(s)`定义复数化。

比如`{ "你有{}条消息": "You have {} message(s)" }`定义用`{}`所匹配的表达式复数化`message`，也就是当`{}`匹配的表达式`>1`时，`message`会变成`messages`。

`(s)`绑定的是它所在位置前面最近的`{}`。

## 序数`(th)`

`(th)`定义序数。

比如`{ "第{}条消息": "The {}(th) message" }`定义将`{}`所匹配的表达式转换为序数，比如当`{}`匹配的表达式`==3`时，会转换为`3rd`。

`(th)`必须紧跟`{}`。

## 映射`(->)`

映射显式定义如何转换匹配到的表达式。

比如`{ "{}月": "{|map 0->Jan,1->Feb,...,11->Dec}"`定义当`n == 0`时翻译为`Jan`，当`n == 1`时翻译为`Feb`，等等。

## [prettier `{" "}` 问题](https://github.com/prettier/prettier/issues/4223)

为了保持jsx的空格语义，prettier会在格式化代码需要在空格后面换行时把空格变成`{" "}`，这会使jsx结构发生变化，原本的空格文本会变成一个占位符，导致需要更改字典。因为prettier暂时没有提供禁用这种格式化的选项，所以`@jacklu/babel-plugin-i18n`对此作了特殊处理，将源代码中的`{" "}`等同于空格文本，使格式化前后字典的词条不变。

比如：

```js
<p>点击 <a>LINK</a> 查看详情</p>;
```

经过格式化会变成：

```js
<p>
	点击{" "}
	<a>LINK</a>
	{" "}查看详情
</p>;
```

词条仍然是`点击 {} 查看详情`，不用改成`点击{}{}{}查看详情`。

## 转义

文本中的`{`、`}`、`\`字符分别需要转义为`\{`、`\}`、`\\`。

比如`"不能包含以下字符：\\()[]{}"`的词条需要定义为`{ "不能包含以下字符：\\\\()[]\\{\\}": "Cannot contain following characters: \\\\()[]\\{\\}" }`。

# 字典文件

将字典保存为`i18n.json`文件后，这个字典就会作用于它所在的目录，包括子目录。在包含多个字典文件的项目里字典文件形成层级，对于一个源代码文件，更近的字典文件中的词条具有更高的优先级。

有两种级别的字典文件：

* 目录级别，`i18n.json`作用于它所在的目录。
* 文件级别，`index.js.i18n.json`作用于`index.js`。
